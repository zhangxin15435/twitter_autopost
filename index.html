<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Twitteræ™ºèƒ½å¤šè´¦å·å‘å¸ƒæ§åˆ¶å°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            padding: 40px;
            max-width: 1000px;
            width: 100%;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            color: #1DA1F2;
            font-size: 2.5em;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .header p {
            color: #657786;
            font-size: 1.1em;
        }

        /* æ ‡ç­¾é¡µæ ·å¼ */
        .tab-container {
            margin-bottom: 30px;
        }

        .tab-buttons {
            display: flex;
            border-bottom: 2px solid #E1E8ED;
            margin-bottom: 20px;
        }

        .tab-button {
            background: none;
            border: none;
            padding: 15px 25px;
            font-size: 1.1em;
            font-weight: 600;
            color: #657786;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            flex: 1;
        }

        .tab-button.active {
            color: #1DA1F2;
            border-bottom-color: #1DA1F2;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* æ–‡ä»¶ä¸Šä¼ åŒºåŸŸ */
        .upload-area {
            border: 2px dashed #E1E8ED;
            border-radius: 12px;
            padding: 40px;
            text-align: center;
            margin-bottom: 25px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .upload-area:hover,
        .upload-area.dragover {
            border-color: #1DA1F2;
            background: #F0F8FF;
        }

        .upload-icon {
            font-size: 3em;
            color: #1DA1F2;
            margin-bottom: 15px;
        }

        .upload-text {
            color: #14171A;
            font-size: 1.1em;
            margin-bottom: 10px;
        }

        .upload-hint {
            color: #657786;
            font-size: 0.9em;
        }

        .file-input {
            display: none;
        }

        /* è¡¨æ ¼æ ·å¼ */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .data-table th,
        .data-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #E1E8ED;
        }

        .data-table th {
            background: #F7F9FA;
            font-weight: 600;
            color: #14171A;
        }

        .data-table tr:hover {
            background: #F7F9FA;
        }

        .status-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            font-weight: 600;
        }

        .status-pending {
            background: #FFF3CD;
            color: #856404;
        }

        .status-ready {
            background: #D4EDDA;
            color: #155724;
        }

        .status-published {
            background: #CCE5FF;
            color: #004085;
        }

        /* åŸæœ‰æ ·å¼ä¿æŒä¸å˜ */
        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #14171A;
            font-size: 1.1em;
        }

        .tweet-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #E1E8ED;
            border-radius: 12px;
            font-size: 16px;
            resize: vertical;
            min-height: 120px;
            font-family: inherit;
            transition: border-color 0.3s ease;
        }

        .tweet-input:focus {
            outline: none;
            border-color: #1DA1F2;
            box-shadow: 0 0 0 3px rgba(29, 161, 242, 0.1);
        }

        .char-counter {
            text-align: right;
            margin-top: 5px;
            font-size: 14px;
            color: #657786;
        }

        .char-counter.warning {
            color: #E1B12C;
        }

        .char-counter.error {
            color: #E0245E;
        }

        .account-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .account-option {
            position: relative;
        }

        .account-option input[type="radio"] {
            position: absolute;
            opacity: 0;
        }

        .account-card {
            padding: 20px;
            border: 2px solid #E1E8ED;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #F7F9FA;
        }

        .account-card:hover {
            border-color: #1DA1F2;
            background: #F0F8FF;
        }

        .account-option input[type="radio"]:checked+.account-card {
            border-color: #1DA1F2;
            background: #F0F8FF;
            box-shadow: 0 0 0 3px rgba(29, 161, 242, 0.1);
        }

        .account-name {
            font-weight: 700;
            color: #14171A;
            margin-bottom: 5px;
            font-size: 1.1em;
        }

        .account-desc {
            color: #657786;
            font-size: 0.9em;
            line-height: 1.4;
        }

        .publish-button {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #1DA1F2, #0d8bd9);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1.2em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
        }

        .publish-button:hover:not(:disabled) {
            background: linear-gradient(135deg, #0d8bd9, #0a7bc4);
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(29, 161, 242, 0.3);
        }

        .publish-button:disabled {
            background: #AAB8C2;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        .button-secondary {
            background: linear-gradient(135deg, #28a745, #20c997);
            flex: 1;
        }

        .button-danger {
            background: linear-gradient(135deg, #dc3545, #c82333);
            flex: 1;
        }

        .instructions {
            background: #F0F8FF;
            border: 1px solid #1DA1F2;
            border-radius: 12px;
            padding: 20px;
            margin-top: 30px;
        }

        .instructions h3 {
            color: #1DA1F2;
            margin-bottom: 15px;
        }

        .instructions ol {
            margin-left: 20px;
        }

        .instructions li {
            margin-bottom: 8px;
            color: #14171A;
            line-height: 1.5;
        }

        .github-link {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: #1DA1F2;
            text-decoration: none;
            font-weight: 600;
        }

        .github-link:hover {
            text-decoration: underline;
        }

        .stats-card {
            background: #F7F9FA;
            border: 1px solid #E1E8ED;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-number {
            font-size: 2em;
            font-weight: 700;
            color: #1DA1F2;
        }

        .stat-label {
            color: #657786;
            font-size: 0.9em;
        }

        @media (max-width: 768px) {
            .container {
                padding: 25px;
                margin: 10px;
            }

            .header h1 {
                font-size: 2em;
            }

            .account-selector {
                grid-template-columns: 1fr;
            }

            .tab-button {
                font-size: 1em;
                padding: 12px 15px;
            }

            .button-group {
                flex-direction: column;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¦ Twitteræ™ºèƒ½å‘å¸ƒæ§åˆ¶å°</h1>
            <p>å¤šè´¦å·æ™ºèƒ½æ¨æ–‡å‘å¸ƒç³»ç»Ÿ - æ”¯æŒå•æ¡å‘å¸ƒå’Œæ‰¹é‡ä¸Šä¼ </p>
        </div>

        <div class="tab-container">
            <div class="tab-buttons">
                <button class="tab-button active" onclick="switchTab('single')">ğŸ“ å•æ¡æ¨æ–‡</button>
                <button class="tab-button" onclick="switchTab('batch')">ğŸ“Š æ‰¹é‡ä¸Šä¼ </button>
                <button class="tab-button" onclick="switchTab('issue')">ğŸ« Issueå‘å¸ƒ</button>
                <button class="tab-button" onclick="switchTab('manage')">ğŸ“‹ å†…å®¹ç®¡ç†</button>
            </div>

            <!-- å•æ¡æ¨æ–‡å‘å¸ƒ -->
            <div class="tab-content active" id="single-tab">
                <form id="tweetForm">
                    <div class="form-group">
                        <label for="tweetContent">æ¨æ–‡å†…å®¹</label>
                        <textarea id="tweetContent" class="tweet-input" placeholder="åœ¨è¿™é‡Œè¾“å…¥æ‚¨è¦å‘å¸ƒçš„æ¨æ–‡å†…å®¹..." maxlength="280"
                            required></textarea>
                        <div class="char-counter" id="charCounter">0 / 280</div>
                    </div>

                    <div class="form-group">
                        <label>é€‰æ‹©å‘å¸ƒè´¦å·</label>
                        <div class="account-selector">
                            <div class="account-option">
                                <input type="radio" id="contextspace" name="account" value="ContextSpace" required>
                                <label for="contextspace" class="account-card">
                                    <div class="account-name">ğŸ¢ ContextSpace</div>
                                    <div class="account-desc">ä¸»è´¦å·ï¼Œç»¼åˆå†…å®¹å‘å¸ƒ</div>
                                </label>
                            </div>

                            <div class="account-option">
                                <input type="radio" id="ossdiscoveries" name="account" value="OSS Discoveries">
                                <label for="ossdiscoveries" class="account-card">
                                    <div class="account-name">ğŸ”§ OSS Discoveries</div>
                                    <div class="account-desc">å¼€æºå·¥å…·å‘ç°ã€è®¾è®¡å·¥å…·</div>
                                </label>
                            </div>

                            <div class="account-option">
                                <input type="radio" id="aiflowwatch" name="account" value="Ai flow watch">
                                <label for="aiflowwatch" class="account-card">
                                    <div class="account-name">ğŸ¤– AI Flow Watch</div>
                                    <div class="account-desc">AIæŠ€æœ¯ã€æœºå™¨å­¦ä¹ ã€å·¥ä½œæµ</div>
                                </label>
                            </div>

                            <div class="account-option">
                                <input type="radio" id="opensourcereader" name="account" value="Open source reader">
                                <label for="opensourcereader" class="account-card">
                                    <div class="account-name">ğŸ“š Open Source Reader</div>
                                    <div class="account-desc">å¼€æºé¡¹ç›®ä»‹ç»ã€æŠ€æœ¯è¯„æµ‹</div>
                                </label>
                            </div>
                        </div>
                    </div>

                    <button type="button" class="publish-button" id="publishBtn" onclick="publishSingleTweet()">
                        ğŸš€ ç«‹å³å‘å¸ƒæ¨æ–‡
                    </button>
                </form>
            </div>

            <!-- æ‰¹é‡ä¸Šä¼  -->
            <div class="tab-content" id="batch-tab">
                <div class="upload-area" onclick="triggerFileInput()" ondrop="handleDrop(event)"
                    ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)">
                    <div class="upload-icon">ğŸ“‚</div>
                    <div class="upload-text">ç‚¹å‡»ä¸Šä¼ æˆ–æ‹–æ‹½CSVæ–‡ä»¶åˆ°æ­¤å¤„</div>
                    <div class="upload-hint">æ”¯æŒæ ¼å¼ï¼šCSVæ–‡ä»¶ï¼ŒåŒ…å«"å†…å®¹ä¸»é¢˜,æå‡ºäºº,å‘å¸ƒè´¦å·,æ˜¯å¦å‘å¸ƒ"å­—æ®µ</div>
                    <input type="file" id="csvFileInput" class="file-input" accept=".csv"
                        onchange="handleFileSelect(event)">
                </div>

                <div id="csvPreview" style="display: none;">
                    <h3>ğŸ“‹ CSVæ–‡ä»¶é¢„è§ˆ</h3>
                    <div class="stats-card">
                        <div class="stats-grid">
                            <div class="stat-item">
                                <div class="stat-number" id="totalCount">0</div>
                                <div class="stat-label">æ€»æ¡æ•°</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-number" id="readyCount">0</div>
                                <div class="stat-label">å¾…å‘å¸ƒ</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-number" id="publishedCount">0</div>
                                <div class="stat-label">å·²å‘å¸ƒ</div>
                            </div>
                        </div>
                    </div>
                    <div style="overflow-x: auto;">
                        <table class="data-table" id="csvTable">
                            <thead>
                                <tr>
                                    <th>å†…å®¹ä¸»é¢˜</th>
                                    <th>æå‡ºäºº</th>
                                    <th>å‘å¸ƒè´¦å·</th>
                                    <th>çŠ¶æ€</th>
                                    <th>æ“ä½œ</th>
                                </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                    </div>

                    <div class="button-group">
                        <button class="publish-button button-secondary" onclick="publishBatchTweets()">
                            ğŸš€ æ‰¹é‡å‘å¸ƒå¾…å‘å¸ƒå†…å®¹
                        </button>
                        <button class="publish-button button-danger" onclick="clearData()">
                            ğŸ—‘ï¸ æ¸…ç©ºæ•°æ®
                        </button>
                    </div>
                </div>
            </div>

            <!-- Issueå‘å¸ƒ -->
            <div class="tab-content" id="issue-tab">
                <div class="stats-card">
                    <h3>ğŸ« é€šè¿‡GitHub Issueå‘å¸ƒæ¨æ–‡</h3>
                    <p style="color: #657786; margin-bottom: 20px;">
                        è¿™æ˜¯<strong>å®Œå…¨å…¬å¼€</strong>çš„å‘å¸ƒæ–¹å¼ï¼Œä»»ä½•äººéƒ½å¯ä»¥åˆ›å»ºIssueæ¥å‘å¸ƒæ¨æ–‡ï¼Œæ— éœ€ç™»å½•æƒé™ï¼
                    </p>
                </div>

                <form id="issueForm">
                    <div class="form-group">
                        <label for="issueContent">æ¨æ–‡å†…å®¹</label>
                        <textarea id="issueContent" class="tweet-input" placeholder="åœ¨è¿™é‡Œè¾“å…¥è¦å‘å¸ƒçš„æ¨æ–‡å†…å®¹..." maxlength="280"
                            required></textarea>
                        <div class="char-counter" id="issueCharCounter">0 / 280</div>
                    </div>

                    <div class="form-group">
                        <label>å‘å¸ƒè´¦å·</label>
                        <div class="account-selector">
                            <div class="account-option">
                                <input type="radio" id="issue-contextspace" name="issueAccount" value="ContextSpace"
                                    required>
                                <label for="issue-contextspace" class="account-card">
                                    <div class="account-name">ğŸ¢ ContextSpace</div>
                                    <div class="account-desc">ä¸»è´¦å·ï¼Œç»¼åˆå†…å®¹å‘å¸ƒ</div>
                                </label>
                            </div>

                            <div class="account-option">
                                <input type="radio" id="issue-ossdiscoveries" name="issueAccount"
                                    value="OSS Discoveries">
                                <label for="issue-ossdiscoveries" class="account-card">
                                    <div class="account-name">ğŸ”§ OSS Discoveries</div>
                                    <div class="account-desc">å¼€æºå·¥å…·å‘ç°ã€è®¾è®¡å·¥å…·</div>
                                </label>
                            </div>

                            <div class="account-option">
                                <input type="radio" id="issue-aiflowwatch" name="issueAccount" value="Ai flow watch">
                                <label for="issue-aiflowwatch" class="account-card">
                                    <div class="account-name">ğŸ¤– AI Flow Watch</div>
                                    <div class="account-desc">AIæŠ€æœ¯ã€æœºå™¨å­¦ä¹ ã€å·¥ä½œæµ</div>
                                </label>
                            </div>

                            <div class="account-option">
                                <input type="radio" id="issue-opensourcereader" name="issueAccount"
                                    value="Open source reader">
                                <label for="issue-opensourcereader" class="account-card">
                                    <div class="account-name">ğŸ“š Open Source Reader</div>
                                    <div class="account-desc">å¼€æºé¡¹ç›®ä»‹ç»ã€æŠ€æœ¯è¯„æµ‹</div>
                                </label>
                            </div>
                        </div>
                    </div>

                    <button type="button" class="publish-button" id="issuePublishBtn" onclick="createIssueForTweet()">
                        ğŸ« åˆ›å»ºIssueå‘å¸ƒæ¨æ–‡
                    </button>
                </form>

                <div class="instructions" style="margin-top: 30px;">
                    <h3>ğŸ¯ Issueå‘å¸ƒä¼˜åŠ¿</h3>
                    <ul style="margin-left: 20px;">
                        <li><strong>æ— éœ€æƒé™</strong>ï¼šä»»ä½•äººéƒ½å¯ä»¥åˆ›å»ºIssueå‘å¸ƒæ¨æ–‡</li>
                        <li><strong>è‡ªåŠ¨å¤„ç†</strong>ï¼šç³»ç»Ÿè‡ªåŠ¨è§£æIssueå†…å®¹å¹¶å‘å¸ƒ</li>
                        <li><strong>ç»“æœåé¦ˆ</strong>ï¼šå‘å¸ƒç»“æœä¼šåœ¨Issueä¸­è‡ªåŠ¨å›å¤</li>
                        <li><strong>å†å²è®°å½•</strong>ï¼šæ‰€æœ‰å‘å¸ƒè¯·æ±‚éƒ½æœ‰å®Œæ•´è®°å½•</li>
                        <li><strong>å¤šç§æ ¼å¼</strong>ï¼šæ”¯æŒæ–‡æœ¬ã€JSONç­‰å¤šç§è¾“å…¥æ ¼å¼</li>
                    </ul>

                    <h3 style="margin-top: 20px;">ğŸ“ ä½¿ç”¨æ­¥éª¤</h3>
                    <ol style="margin-left: 20px;">
                        <li>åœ¨ä¸Šæ–¹è¾“å…¥æ¨æ–‡å†…å®¹å’Œé€‰æ‹©è´¦å·</li>
                        <li>ç‚¹å‡»"åˆ›å»ºIssueå‘å¸ƒæ¨æ–‡"æŒ‰é’®</li>
                        <li>è·³è½¬åˆ°GitHubï¼Œæ ‡é¢˜å’Œå†…å®¹å·²è‡ªåŠ¨å¡«å……</li>
                        <li>ç‚¹å‡»"Submit new issue"æäº¤</li>
                        <li>ç­‰å¾…è‡ªåŠ¨å‘å¸ƒï¼Œç»“æœä¼šåœ¨Issueä¸­æ˜¾ç¤º</li>
                    </ol>
                </div>
            </div>

            <!-- å†…å®¹ç®¡ç† -->
            <div class="tab-content" id="manage-tab">
                <div class="stats-card">
                    <h3>ğŸ“Š å†…å®¹ç»Ÿè®¡</h3>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-number" id="manageTotalCount">0</div>
                            <div class="stat-label">æœ¬åœ°æ€»æ•°</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number" id="manageReadyCount">0</div>
                            <div class="stat-label">å¾…å‘å¸ƒ</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number" id="managePublishedCount">0</div>
                            <div class="stat-label">å·²å‘å¸ƒ</div>
                        </div>
                    </div>
                </div>

                <div style="overflow-x: auto;">
                    <table class="data-table" id="manageTable">
                        <thead>
                            <tr>
                                <th>å†…å®¹ä¸»é¢˜</th>
                                <th>å‘å¸ƒè´¦å·</th>
                                <th>çŠ¶æ€</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>

                <div class="button-group">
                    <button class="publish-button" onclick="downloadCSV()">
                        ğŸ“¥ ä¸‹è½½CSVæ–‡ä»¶
                    </button>
                    <button class="publish-button button-danger" onclick="clearAllData()">
                        ğŸ—‘ï¸ æ¸…ç©ºæ‰€æœ‰æ•°æ®
                    </button>
                </div>
            </div>
        </div>

        <div class="instructions">
            <h3>ğŸ“‹ ä½¿ç”¨è¯´æ˜</h3>
            <ol>
                <li><strong>å•æ¡æ¨æ–‡</strong>ï¼šç›´æ¥è¾“å…¥å†…å®¹ï¼Œé€‰æ‹©è´¦å·ï¼Œä¸€é”®å‘å¸ƒï¼ˆéœ€è¦GitHubä»“åº“æƒé™ï¼‰</li>
                <li><strong>æ‰¹é‡ä¸Šä¼ </strong>ï¼šä¸Šä¼ CSVæ–‡ä»¶ï¼Œé¢„è§ˆåæ‰¹é‡å‘å¸ƒï¼ˆéœ€è¦GitHubä»“åº“æƒé™ï¼‰</li>
                <li><strong>ğŸ« Issueå‘å¸ƒ</strong>ï¼šä»»ä½•äººéƒ½å¯ä»¥åˆ›å»ºIssueå‘å¸ƒæ¨æ–‡ï¼ˆæ— éœ€æƒé™ï¼Œæ¨èï¼ï¼‰</li>
                <li><strong>å†…å®¹ç®¡ç†</strong>ï¼šæŸ¥çœ‹æ‰€æœ‰å†…å®¹ï¼Œç®¡ç†å‘å¸ƒçŠ¶æ€</li>
                <li>CSVæ–‡ä»¶æ ¼å¼ï¼šå†…å®¹ä¸»é¢˜,æå‡ºäºº,å‘å¸ƒè´¦å·,æ˜¯å¦å‘å¸ƒ</li>
                <li>å‘å¸ƒè´¦å·æ”¯æŒï¼šContextSpace, OSS Discoveries, Ai flow watch, Open source reader</li>
            </ol>
            <p style="margin-top: 15px;">
                <a href="https://github.com/zhangxin15435/twitter_autopost/actions" target="_blank" class="github-link">
                    ğŸ“‚ å‰å¾€GitHub ActionsæŸ¥çœ‹å‘å¸ƒçŠ¶æ€
                </a>
            </p>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let csvData = [];
        let currentTab = 'single';

        // æ ‡ç­¾é¡µåˆ‡æ¢
        function switchTab(tabName) {
            // éšè—æ‰€æœ‰æ ‡ç­¾é¡µå†…å®¹
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });

            // ç§»é™¤æ‰€æœ‰æŒ‰é’®çš„æ¿€æ´»çŠ¶æ€
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active');
            });

            // æ˜¾ç¤ºé€‰ä¸­çš„æ ‡ç­¾é¡µ
            document.getElementById(tabName + '-tab').classList.add('active');

            // æ¿€æ´»é€‰ä¸­çš„æŒ‰é’®
            event.target.classList.add('active');

            currentTab = tabName;

            // å¦‚æœåˆ‡æ¢åˆ°ç®¡ç†æ ‡ç­¾é¡µï¼Œåˆ·æ–°æ•°æ®
            if (tabName === 'manage') {
                refreshManageTab();
            }
        }

        // å•æ¡æ¨æ–‡å‘å¸ƒç›¸å…³ä»£ç ï¼ˆä¿æŒåŸæœ‰åŠŸèƒ½ï¼‰
        const tweetContent = document.getElementById('tweetContent');
        const charCounter = document.getElementById('charCounter');
        const publishBtn = document.getElementById('publishBtn');

        // Issueå‘å¸ƒç›¸å…³å…ƒç´ 
        const issueContent = document.getElementById('issueContent');
        const issueCharCounter = document.getElementById('issueCharCounter');
        const issuePublishBtn = document.getElementById('issuePublishBtn');

        // å­—ç¬¦è®¡æ•°å™¨
        tweetContent.addEventListener('input', function () {
            const length = this.value.length;
            const remaining = 280 - length;

            charCounter.textContent = `${length} / 280`;

            if (remaining < 20) {
                charCounter.className = 'char-counter error';
            } else if (remaining < 50) {
                charCounter.className = 'char-counter warning';
            } else {
                charCounter.className = 'char-counter';
            }

            updatePublishButton();
        });

        // Issueå­—ç¬¦è®¡æ•°å™¨
        if (issueContent) {
            issueContent.addEventListener('input', function () {
                const length = this.value.length;
                const remaining = 280 - length;

                issueCharCounter.textContent = `${length} / 280`;

                if (remaining < 20) {
                    issueCharCounter.className = 'char-counter error';
                } else if (remaining < 50) {
                    issueCharCounter.className = 'char-counter warning';
                } else {
                    issueCharCounter.className = 'char-counter';
                }

                updateIssuePublishButton();
            });
        }

        // ç›‘å¬è´¦å·é€‰æ‹©
        document.querySelectorAll('input[name="account"]').forEach(radio => {
            radio.addEventListener('change', updatePublishButton);
        });

        // ç›‘å¬Issueè´¦å·é€‰æ‹©
        document.querySelectorAll('input[name="issueAccount"]').forEach(radio => {
            radio.addEventListener('change', updateIssuePublishButton);
        });

        function updatePublishButton() {
            const content = tweetContent.value.trim();
            const selectedAccount = document.querySelector('input[name="account"]:checked');

            publishBtn.disabled = !content || !selectedAccount || content.length > 280;
        }

        function updateIssuePublishButton() {
            if (!issueContent || !issuePublishBtn) return;

            const content = issueContent.value.trim();
            const selectedAccount = document.querySelector('input[name="issueAccount"]:checked');

            issuePublishBtn.disabled = !content || !selectedAccount || content.length > 280;
        }

        function publishSingleTweet() {
            const content = tweetContent.value.trim();
            const selectedAccount = document.querySelector('input[name="account"]:checked');

            if (!content || !selectedAccount) {
                alert('è¯·è¾“å…¥æ¨æ–‡å†…å®¹å¹¶é€‰æ‹©å‘å¸ƒè´¦å·');
                return;
            }

            if (content.length > 280) {
                alert('æ¨æ–‡å†…å®¹è¶…è¿‡280å­—ç¬¦é™åˆ¶');
                return;
            }

            // æ·»åŠ åˆ°æœ¬åœ°å­˜å‚¨
            addToLocalStorage({
                content: content,
                author: 'æ‰‹åŠ¨è¾“å…¥',
                account: selectedAccount.value,
                status: 'å¾…å‘å¸ƒ',
                timestamp: new Date().toISOString()
            });

            // å‘å¸ƒæ¨æ–‡
            publishToGitHub([{
                content: content,
                account: selectedAccount.value
            }]);
        }

        // Issueå‘å¸ƒåŠŸèƒ½
        function createIssueForTweet() {
            const content = issueContent.value.trim();
            const selectedAccount = document.querySelector('input[name="issueAccount"]:checked');

            if (!content || !selectedAccount) {
                alert('è¯·è¾“å…¥æ¨æ–‡å†…å®¹å¹¶é€‰æ‹©å‘å¸ƒè´¦å·');
                return;
            }

            if (content.length > 280) {
                alert('æ¨æ–‡å†…å®¹è¶…è¿‡280å­—ç¬¦é™åˆ¶');
                return;
            }

            // æ„å»ºIssueæ ‡é¢˜
            const title = encodeURIComponent(`[æ¨æ–‡å‘å¸ƒ] ${content.substring(0, 30)}${content.length > 30 ? '...' : ''}`);

            // æ„å»ºIssueå†…å®¹
            const issueBody = `## ğŸ“ æ¨æ–‡å†…å®¹

**å†…å®¹:** ${content}
**è´¦å·:** ${selectedAccount.value}

---

## ğŸ¤– è‡ªåŠ¨å‘å¸ƒè¯´æ˜

æ­¤Issueä¼šè‡ªåŠ¨è§¦å‘æ¨æ–‡å‘å¸ƒæµç¨‹ï¼š
- ç³»ç»Ÿä¼šè§£æä¸Šè¿°å†…å®¹å¹¶å‘å¸ƒåˆ°æŒ‡å®šçš„Twitterè´¦å·
- å‘å¸ƒå®Œæˆåä¼šåœ¨æ­¤Issueä¸­å›å¤ç»“æœ
- è¯·ä¸è¦ä¿®æ”¹æˆ–åˆ é™¤ä¸Šè¿°æ ¼å¼åŒ–å†…å®¹

å‘å¸ƒæ—¶é—´: ${new Date().toLocaleString('zh-CN')}`;

            // æ„å»ºGitHub Issue URL
            const repoUrl = 'https://github.com/zhangxin15435/twitter_autopost';
            const issueUrl = `${repoUrl}/issues/new?title=${title}&body=${encodeURIComponent(issueBody)}&labels=pending`;

            // æ˜¾ç¤ºç¡®è®¤ä¿¡æ¯
            const confirmMessage = `å³å°†åˆ›å»ºGitHub Issueå‘å¸ƒæ¨æ–‡ï¼š

ğŸ“ å†…å®¹: ${content}
ğŸ¯ è´¦å·: ${selectedAccount.value}

âœ… ä¼˜åŠ¿:
- ä»»ä½•äººéƒ½å¯ä»¥ä½¿ç”¨ï¼ˆæ— éœ€ä»“åº“æƒé™ï¼‰
- è‡ªåŠ¨å‘å¸ƒå¤„ç†
- å®Œæ•´çš„å†å²è®°å½•
- ç»“æœè‡ªåŠ¨åé¦ˆ

ç¡®è®¤è¦è·³è½¬åˆ°GitHubåˆ›å»ºIssueå—ï¼Ÿ`;

            if (confirm(confirmMessage)) {
                // ä¿å­˜æ•°æ®ä¾›åç»­å‚è€ƒ
                localStorage.setItem('lastIssueData', JSON.stringify({
                    content: content,
                    account: selectedAccount.value,
                    timestamp: new Date().toISOString()
                }));

                alert('å³å°†è·³è½¬åˆ°GitHub Issueé¡µé¢ï¼\n\nğŸ“‹ æ“ä½œæ­¥éª¤ï¼š\n1. ç¡®è®¤æ ‡é¢˜å’Œå†…å®¹å·²è‡ªåŠ¨å¡«å……\n2. ç‚¹å‡»"Submit new issue"æäº¤\n3. ç­‰å¾…è‡ªåŠ¨å‘å¸ƒï¼ˆé€šå¸¸1-2åˆ†é’Ÿï¼‰\n4. æŸ¥çœ‹Issueä¸­çš„å‘å¸ƒç»“æœåé¦ˆ');

                // è·³è½¬åˆ°GitHub Issueåˆ›å»ºé¡µé¢
                window.open(issueUrl, '_blank');

                // æ¸…ç©ºè¡¨å•
                issueContent.value = '';
                document.querySelector('input[name="issueAccount"]:checked').checked = false;
                updateIssuePublishButton();

                // æ›´æ–°å­—ç¬¦è®¡æ•°æ˜¾ç¤º
                issueCharCounter.textContent = '0 / 280';
                issueCharCounter.className = 'char-counter';
            }
        }

        // æ–‡ä»¶ä¸Šä¼ ç›¸å…³åŠŸèƒ½
        function triggerFileInput() {
            document.getElementById('csvFileInput').click();
        }

        function handleDragOver(event) {
            event.preventDefault();
            event.target.closest('.upload-area').classList.add('dragover');
        }

        function handleDragLeave(event) {
            event.target.closest('.upload-area').classList.remove('dragover');
        }

        function handleDrop(event) {
            event.preventDefault();
            event.target.closest('.upload-area').classList.remove('dragover');

            const files = event.dataTransfer.files;
            if (files.length > 0) {
                handleFileSelect({ target: { files: files } });
            }
        }

        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (!file) return;

            if (!file.name.toLowerCase().endsWith('.csv')) {
                alert('è¯·é€‰æ‹©CSVæ–‡ä»¶ï¼');
                return;
            }

            const reader = new FileReader();
            reader.onload = function (e) {
                const csvText = e.target.result;
                parseCSVData(csvText);
            };
            reader.readAsText(file, 'utf-8');
        }

        function parseCSVData(csvText) {
            const lines = csvText.split('\n');
            const headers = lines[0].split(',').map(h => h.trim().replace(/"/g, ''));

            csvData = [];

            for (let i = 1; i < lines.length; i++) {
                const line = lines[i].trim();
                if (!line) continue;

                const values = parseCSVLine(line);
                if (values.length >= 4) {
                    csvData.push({
                        content: values[0] || '',
                        author: values[1] || '',
                        account: values[2] || '',
                        status: values[3] === 'æ˜¯' ? 'å·²å‘å¸ƒ' : 'å¾…å‘å¸ƒ',
                        timestamp: new Date().toISOString()
                    });
                }
            }

            displayCSVPreview();
            saveToLocalStorage();
        }

        function parseCSVLine(line) {
            const result = [];
            let current = '';
            let inQuotes = false;

            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                const nextChar = line[i + 1];

                if (char === '"' && !inQuotes) {
                    inQuotes = true;
                } else if (char === '"' && inQuotes && nextChar === '"') {
                    current += '"';
                    i++; // è·³è¿‡ä¸‹ä¸€ä¸ªå¼•å·
                } else if (char === '"' && inQuotes) {
                    inQuotes = false;
                } else if (char === ',' && !inQuotes) {
                    result.push(current.trim());
                    current = '';
                } else {
                    current += char;
                }
            }

            result.push(current.trim());
            return result;
        }

        function displayCSVPreview() {
            const preview = document.getElementById('csvPreview');
            const table = document.getElementById('csvTable').querySelector('tbody');

            // æ¸…ç©ºè¡¨æ ¼
            table.innerHTML = '';

            // ç»Ÿè®¡æ•°æ®
            let totalCount = csvData.length;
            let readyCount = csvData.filter(item => item.status === 'å¾…å‘å¸ƒ').length;
            let publishedCount = csvData.filter(item => item.status === 'å·²å‘å¸ƒ').length;

            // æ›´æ–°ç»Ÿè®¡
            document.getElementById('totalCount').textContent = totalCount;
            document.getElementById('readyCount').textContent = readyCount;
            document.getElementById('publishedCount').textContent = publishedCount;

            // å¡«å……è¡¨æ ¼
            csvData.forEach((item, index) => {
                const row = table.insertRow();
                row.innerHTML = `
                    <td style="max-width: 300px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" title="${item.content}">${item.content}</td>
                    <td>${item.author}</td>
                    <td>${item.account}</td>
                    <td><span class="status-badge ${item.status === 'å·²å‘å¸ƒ' ? 'status-published' : 'status-ready'}">${item.status}</span></td>
                    <td>
                        <button onclick="toggleStatus(${index})" style="padding: 4px 8px; border: none; border-radius: 4px; background: #1DA1F2; color: white; cursor: pointer;">
                            ${item.status === 'å·²å‘å¸ƒ' ? 'è®¾ä¸ºå¾…å‘å¸ƒ' : 'è®¾ä¸ºå·²å‘å¸ƒ'}
                        </button>
                    </td>
                `;
            });

            preview.style.display = 'block';
        }

        function toggleStatus(index) {
            csvData[index].status = csvData[index].status === 'å·²å‘å¸ƒ' ? 'å¾…å‘å¸ƒ' : 'å·²å‘å¸ƒ';
            displayCSVPreview();
            saveToLocalStorage();
        }

        function publishBatchTweets() {
            const readyItems = csvData.filter(item => item.status === 'å¾…å‘å¸ƒ');

            if (readyItems.length === 0) {
                alert('æ²¡æœ‰å¾…å‘å¸ƒçš„å†…å®¹ï¼');
                return;
            }

            if (confirm(`ç¡®è®¤è¦å‘å¸ƒ ${readyItems.length} æ¡æ¨æ–‡å—ï¼Ÿ`)) {
                publishToGitHub(readyItems);

                // æ›´æ–°çŠ¶æ€ä¸ºå·²å‘å¸ƒ
                csvData.forEach(item => {
                    if (item.status === 'å¾…å‘å¸ƒ') {
                        item.status = 'å·²å‘å¸ƒ';
                    }
                });

                displayCSVPreview();
                saveToLocalStorage();
            }
        }

        function publishToGitHub(items) {
            // æ„å»ºGitHub Actions URL
            const repoUrl = 'https://github.com/zhangxin15435/twitter_autopost';
            const actionsUrl = `${repoUrl}/actions/workflows/manual_publish.yml`;

            // æ„å»ºæ‰¹é‡å‘å¸ƒæ•°æ®
            const batchData = items.map(item => ({
                content: item.content,
                account: item.account
            }));

            // ä¿å­˜åˆ°localStorageä¾›GitHub Actionsä½¿ç”¨
            localStorage.setItem('batchTweets', JSON.stringify({
                data: batchData,
                timestamp: new Date().toISOString()
            }));

            const message = `å‡†å¤‡å‘å¸ƒ ${items.length} æ¡æ¨æ–‡åˆ°GitHub Actions\n\n${items.slice(0, 3).map(item => `â€¢ ${item.content.substring(0, 50)}... â†’ ${item.account}`).join('\n')}${items.length > 3 ? `\n...è¿˜æœ‰ ${items.length - 3} æ¡` : ''}`;

            if (confirm(message + '\n\nç¡®è®¤è¦è·³è½¬åˆ°GitHub Actionså—ï¼Ÿ')) {
                alert('æ•°æ®å·²å‡†å¤‡å®Œæˆï¼\n\næ¥ä¸‹æ¥åœ¨GitHub Actionsé¡µé¢ï¼š\n1. ç‚¹å‡»"Run workflow"\n2. é€‰æ‹©"æ‰¹é‡å‘å¸ƒæ¨¡å¼"\n3. ç‚¹å‡»"Run workflow"æ‰§è¡Œ');
                window.open(actionsUrl, '_blank');
            }
        }

        // æœ¬åœ°å­˜å‚¨åŠŸèƒ½
        function saveToLocalStorage() {
            localStorage.setItem('twitterData', JSON.stringify(csvData));
        }

        function loadFromLocalStorage() {
            const data = localStorage.getItem('twitterData');
            if (data) {
                csvData = JSON.parse(data);
            }
        }

        function addToLocalStorage(item) {
            csvData.push(item);
            saveToLocalStorage();
        }

        function clearData() {
            if (confirm('ç¡®è®¤è¦æ¸…ç©ºå½“å‰æ‰¹é‡ä¸Šä¼ çš„æ•°æ®å—ï¼Ÿ')) {
                csvData = [];
                document.getElementById('csvPreview').style.display = 'none';
                document.getElementById('csvFileInput').value = '';
                saveToLocalStorage();
            }
        }

        function clearAllData() {
            if (confirm('ç¡®è®¤è¦æ¸…ç©ºæ‰€æœ‰æœ¬åœ°å­˜å‚¨çš„æ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) {
                localStorage.removeItem('twitterData');
                localStorage.removeItem('batchTweets');
                localStorage.removeItem('pendingTweet');
                csvData = [];
                refreshManageTab();
                if (document.getElementById('csvPreview').style.display !== 'none') {
                    displayCSVPreview();
                }
            }
        }

        // å†…å®¹ç®¡ç†åŠŸèƒ½
        function refreshManageTab() {
            loadFromLocalStorage();

            const table = document.getElementById('manageTable').querySelector('tbody');
            table.innerHTML = '';

            // ç»Ÿè®¡æ•°æ®
            let totalCount = csvData.length;
            let readyCount = csvData.filter(item => item.status === 'å¾…å‘å¸ƒ').length;
            let publishedCount = csvData.filter(item => item.status === 'å·²å‘å¸ƒ').length;

            // æ›´æ–°ç»Ÿè®¡
            document.getElementById('manageTotalCount').textContent = totalCount;
            document.getElementById('manageReadyCount').textContent = readyCount;
            document.getElementById('managePublishedCount').textContent = publishedCount;

            // å¡«å……è¡¨æ ¼
            csvData.forEach((item, index) => {
                const row = table.insertRow();
                row.innerHTML = `
                    <td style="max-width: 400px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" title="${item.content}">${item.content}</td>
                    <td>${item.account}</td>
                    <td><span class="status-badge ${item.status === 'å·²å‘å¸ƒ' ? 'status-published' : 'status-ready'}">${item.status}</span></td>
                    <td>
                        <button onclick="toggleStatus(${index}); refreshManageTab();" style="padding: 4px 8px; border: none; border-radius: 4px; background: #1DA1F2; color: white; cursor: pointer; margin-right: 5px;">
                            åˆ‡æ¢çŠ¶æ€
                        </button>
                        <button onclick="deleteItem(${index})" style="padding: 4px 8px; border: none; border-radius: 4px; background: #dc3545; color: white; cursor: pointer;">
                            åˆ é™¤
                        </button>
                    </td>
                `;
            });
        }

        function deleteItem(index) {
            if (confirm('ç¡®è®¤è¦åˆ é™¤è¿™æ¡å†…å®¹å—ï¼Ÿ')) {
                csvData.splice(index, 1);
                saveToLocalStorage();
                refreshManageTab();

                // å¦‚æœå½“å‰åœ¨æ‰¹é‡é¢„è§ˆé¡µé¢ï¼Œä¹Ÿéœ€è¦æ›´æ–°
                if (document.getElementById('csvPreview').style.display !== 'none') {
                    displayCSVPreview();
                }
            }
        }

        function downloadCSV() {
            if (csvData.length === 0) {
                alert('æ²¡æœ‰æ•°æ®å¯ä»¥ä¸‹è½½ï¼');
                return;
            }

            let csvContent = 'å†…å®¹ä¸»é¢˜,æå‡ºäºº,å‘å¸ƒè´¦å·,æ˜¯å¦å‘å¸ƒ\n';
            csvData.forEach(item => {
                const status = item.status === 'å·²å‘å¸ƒ' ? 'æ˜¯' : 'å¦';
                csvContent += `"${item.content}","${item.author}","${item.account}","${status}"\n`;
            });

            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `twitter_content_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.addEventListener('load', function () {
            loadFromLocalStorage();
            updatePublishButton();
            updateIssuePublishButton();

            // æ£€æŸ¥æ˜¯å¦æœ‰å¾…å‘å¸ƒçš„æ¨æ–‡ï¼ˆå…¼å®¹æ—§ç‰ˆæœ¬ï¼‰
            const pendingTweet = localStorage.getItem('pendingTweet');
            if (pendingTweet) {
                try {
                    const data = JSON.parse(pendingTweet);
                    const timeDiff = new Date() - new Date(data.timestamp);

                    if (timeDiff < 3600000) {
                        tweetContent.value = data.content;
                        document.querySelector(`input[value="${data.account}"]`).checked = true;
                        updatePublishButton();
                        localStorage.removeItem('pendingTweet');
                    }
                } catch (e) {
                    localStorage.removeItem('pendingTweet');
                }
            }

            // å¦‚æœæœ‰æ•°æ®ï¼Œæ˜¾ç¤ºæ‰¹é‡é¢„è§ˆ
            if (csvData.length > 0) {
                displayCSVPreview();
            }
        });
    </script>
</body>

</html>